"use strict";var app=angular.module("mapApp",["ngRoute","ngWebSocket","leaflet-directive"]);
app.controller("MainMapCtrl",["$scope","$websocket","$filter","$timeout","$interval","leafletData",function(e,t,n,a,o,r){function i(e){return"MAC: "+e.mac+"<br/>-----------------------------<br/>LAT: "+e.location.lat+"<br/>LON: "+e.location.lon+"<br/>-----------------------------<br/>STATUS: "+(e.status&&e.status.isOnline?"ONLINE":"OFFLINE")}function l(e){for(var t=JSON.parse(e),n=0;n<t.data.length;n++){var a=t.data[n];s.hasOwnProperty(a.mac)?(a=angular.extend({},s[a.mac],a),"location"===t.name&&a.marker.Move(a.location.lat,a.location.lon)):"location"===t.name&&(a.marker=new PruneCluster.Marker(a.location.lat,a.location.lon),c.RegisterMarker(a.marker)),a.marker.data.info=a,s[a.mac]=a}}angular.extend(e,{center:{lat:31,lng:85,zoom:4},position:{lat:51,lng:0},layers:{baselayers:{xyz:{name:"Cloudmade Tourist",url:"http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png",layerParams:{key:"007b9471b4c74da4a6ec7ff43552b16f",styleId:7},type:"xyz"}},overlays:{markersOverlay:{name:"Markers",type:"group",visible:!0}}}}),e.collection=[],e.settings={pagination:{currentPage:0,pageSize:10},search:""},e.isNextPageAvailable=function(){return e.settings.pagination.currentPage>=e.getDataLength()/e.settings.pagination.pageSize-1},e.numberOfPages=function(){return Math.ceil(e.getDataLength()/e.settings.pagination.pageSize)},e.getDataLength=function(){return n("filter")(e.collection,{mac:e.settings.search}).length},e.moveMap=function(t){e.center={lat:t.location.lat,lng:t.location.lon,zoom:14}};var c=new PruneClusterForLeaflet(60),s={},u=t("ws://localhost:8091/");!function(){r.getMap().then(function(t){t.addLayer(c),c.PrepareLeafletMarker=function(e,t){var n;e.on("popupopen",function(a){n=o(function(){e._popup._content=i(t.info),e._popup.update()},200)}),e.on("popupclose",function(e){o.cancel(n)}),e.getPopup()||e.bindPopup(i(t.info))},u.send(JSON.stringify({name:"start"})),u.onMessage(function(e){a(l(e.data),0)}),o(function(){c.ProcessView(),e.collection=Object.values(s)},500)})}()}]),app.filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb250cm9sbGVycy9NYWluTWFwQ3RybC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiR3ZWJzb2NrZXQiLCIkZmlsdGVyIiwiJHRpbWVvdXQiLCIkaW50ZXJ2YWwiLCJsZWFmbGV0RGF0YSIsImdldFBvcHVwIiwibWFya2VyIiwibWFjIiwibG9jYXRpb24iLCJsYXQiLCJsb24iLCJzdGF0dXMiLCJpc09ubGluZSIsInByZXBhcmVNZXNzYWdlIiwiZGF0YSIsInBhY2thZ2VEYXRhIiwiSlNPTiIsInBhcnNlIiwiaSIsImxlbmd0aCIsInRhZyIsIm1hcmtlcnMiLCJoYXNPd25Qcm9wZXJ0eSIsImV4dGVuZCIsIm5hbWUiLCJNb3ZlIiwiUHJ1bmVDbHVzdGVyIiwiTWFya2VyIiwibGVhZmxldFZpZXciLCJSZWdpc3Rlck1hcmtlciIsImluZm8iLCJjZW50ZXIiLCJsbmciLCJ6b29tIiwicG9zaXRpb24iLCJsYXllcnMiLCJiYXNlbGF5ZXJzIiwieHl6IiwidXJsIiwibGF5ZXJQYXJhbXMiLCJrZXkiLCJzdHlsZUlkIiwidHlwZSIsIm92ZXJsYXlzIiwibWFya2Vyc092ZXJsYXkiLCJ2aXNpYmxlIiwiY29sbGVjdGlvbiIsInNldHRpbmdzIiwicGFnaW5hdGlvbiIsImN1cnJlbnRQYWdlIiwicGFnZVNpemUiLCJzZWFyY2giLCJpc05leHRQYWdlQXZhaWxhYmxlIiwiZ2V0RGF0YUxlbmd0aCIsIm51bWJlck9mUGFnZXMiLCJNYXRoIiwiY2VpbCIsIm1vdmVNYXAiLCJQcnVuZUNsdXN0ZXJGb3JMZWFmbGV0Iiwid3MiLCJnZXRNYXAiLCJ0aGVuIiwibWFwIiwiYWRkTGF5ZXIiLCJQcmVwYXJlTGVhZmxldE1hcmtlciIsImxlYWZsZXRNYXJrZXIiLCJwcm9taXNlIiwib24iLCJwb3B1cCIsIl9wb3B1cCIsIl9jb250ZW50IiwidXBkYXRlIiwiY2FuY2VsIiwiYmluZFBvcHVwIiwic2VuZCIsInN0cmluZ2lmeSIsIm9uTWVzc2FnZSIsIm1lc3NhZ2UiLCJQcm9jZXNzVmlldyIsIk9iamVjdCIsInZhbHVlcyIsImZpbHRlciIsImlucHV0Iiwic3RhcnQiLCJzbGljZSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFJQSxLQUFNQyxRQUFRQyxPQUFPLFVBQ3JCLFVBQ0EsY0FDQTtBQ0xKRixJQUFJRyxXQUFXLGVBQ1gsU0FDQSxhQUNBLFVBQ0EsV0FDQSxZQUNBLGNBQ0EsU0FBU0MsRUFBUUMsRUFBWUMsRUFBU0MsRUFBVUMsRUFBV0MsR0FrRXZELFFBQVNDLEdBQVNDLEdBV2QsTUFSUSxRQUFVQSxFQUFPQyxJQUFNLCtDQUVqQkQsRUFBT0UsU0FBU0MsSUFBTSxhQUN0QkgsRUFBT0UsU0FBU0UsSUFBTSxtREFFbEJKLEVBQU9LLFFBQVVMLEVBQU9LLE9BQU9DLFNBQVcsU0FBVyxXQU0zRSxRQUFTQyxHQUFlQyxHQUlwQixJQUFLLEdBSERDLEdBQWNDLEtBQUtDLE1BQU1ILEdBR3BCSSxFQUFJLEVBQUdBLEVBQUlILEVBQVlELEtBQUtLLE9BQVFELElBQUssQ0FDOUMsR0FBSUUsR0FBTUwsRUFBWUQsS0FBS0ksRUFFdkJHLEdBQVFDLGVBQWVGLEVBQUliLE1BQzNCYSxFQUFNeEIsUUFBUTJCLFVBQVdGLEVBQVFELEVBQUliLEtBQU1hLEdBRWxCLGFBQXJCTCxFQUFZUyxNQUNaSixFQUFJZCxPQUFPbUIsS0FBS0wsRUFBSVosU0FBU0MsSUFBS1csRUFBSVosU0FBU0UsTUFHMUIsYUFBckJLLEVBQVlTLE9BQ1pKLEVBQUlkLE9BQVMsR0FBSW9CLGNBQWFDLE9BQU9QLEVBQUlaLFNBQVNDLElBQUtXLEVBQUlaLFNBQVNFLEtBR3BFa0IsRUFBWUMsZUFBZVQsRUFBSWQsU0FJdkNjLEVBQUlkLE9BQU9RLEtBQUtnQixLQUFPVixFQUN2QkMsRUFBUUQsRUFBSWIsS0FBT2EsR0F0RzNCeEIsUUFBUTJCLE9BQU94QixHQUNYZ0MsUUFDSXRCLElBQUssR0FDTHVCLElBQUssR0FDTEMsS0FBTSxHQUVWQyxVQUNJekIsSUFBSyxHQUNMdUIsSUFBSyxHQUVURyxRQUNJQyxZQUNJQyxLQUNJYixLQUFNLG9CQUNOYyxJQUFLLG9FQUNMQyxhQUNJQyxJQUFLLG1DQUNMQyxRQUFTLEdBRWJDLEtBQU0sUUFHZEMsVUFDSUMsZ0JBQ0lwQixLQUFNLFVBQ05rQixLQUFNLFFBQ05HLFNBQVMsT0FNekI5QyxFQUFPK0MsY0FDUC9DLEVBQU9nRCxVQUNIQyxZQUNJQyxZQUFhLEVBQ2JDLFNBQVUsSUFFZEMsT0FBUSxJQUdacEQsRUFBT3FELG9CQUFzQixXQUN6QixNQUFPckQsR0FBT2dELFNBQVNDLFdBQVdDLGFBQWVsRCxFQUFPc0QsZ0JBQWtCdEQsRUFBT2dELFNBQVNDLFdBQVdFLFNBQVcsR0FHcEhuRCxFQUFPdUQsY0FBZ0IsV0FDbkIsTUFBT0MsTUFBS0MsS0FBS3pELEVBQU9zRCxnQkFBa0J0RCxFQUFPZ0QsU0FBU0MsV0FBV0UsV0FHekVuRCxFQUFPc0QsY0FBZ0IsV0FDbkIsTUFBT3BELEdBQVEsVUFBVUYsRUFBTytDLFlBQWN2QyxJQUFLUixFQUFPZ0QsU0FBU0ksU0FBVWhDLFFBR2pGcEIsRUFBTzBELFFBQVUsU0FBVW5ELEdBQ3ZCUCxFQUFPZ0MsUUFDSHRCLElBQUtILEVBQU9FLFNBQVNDLElBQ3JCdUIsSUFBSzFCLEVBQU9FLFNBQVNFLElBQ3JCdUIsS0FBTSxJQUlkLElBQUlMLEdBQWMsR0FBSThCLHdCQUF1QixJQUN6Q3JDLEtBQ0FzQyxFQUFLM0QsRUFBVyx5QkErQ3BCLFdBQ0lJLEVBQVl3RCxTQUFTQyxLQUFLLFNBQVNDLEdBQy9CQSxFQUFJQyxTQUFTbkMsR0FFYkEsRUFBWW9DLHFCQUF1QixTQUFTQyxFQUFlbkQsR0FDdkQsR0FBSW9ELEVBRUpELEdBQWNFLEdBQUcsWUFBYSxTQUFVQyxHQUNwQ0YsRUFBVS9ELEVBQVUsV0FDaEI4RCxFQUFjSSxPQUFPQyxTQUFXakUsRUFBU1MsRUFBS2dCLE1BQzlDbUMsRUFBY0ksT0FBT0UsVUFDdEIsT0FHUE4sRUFBY0UsR0FBRyxhQUFjLFNBQVVDLEdBQ3JDakUsRUFBVXFFLE9BQU9OLEtBR2hCRCxFQUFjNUQsWUFDZjRELEVBQWNRLFVBQVVwRSxFQUFTUyxFQUFLZ0IsUUFJOUM2QixFQUFHZSxLQUFLMUQsS0FBSzJELFdBQVluRCxLQUFNLFdBRS9CbUMsRUFBR2lCLFVBQVUsU0FBU0MsR0FDbEIzRSxFQUFTVyxFQUFlZ0UsRUFBUS9ELE1BQU8sS0FHM0NYLEVBQVUsV0FDTnlCLEVBQVlrRCxjQUNaL0UsRUFBTytDLFdBQWFpQyxPQUFPQyxPQUFPM0QsSUFDbkMsYUFPbkIxQixJQUFJc0YsT0FBTyxZQUFhLFdBQ3BCLE1BQU8sVUFBU0MsRUFBT0MsR0FHbkIsTUFGQUEsSUFBU0EsRUFFRkQsRUFBTUUsTUFBTUQiLCJmaWxlIjoic3lzdGVtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtYXBBcHAnLCBbXG4gICAgJ25nUm91dGUnLFxuICAgICduZ1dlYlNvY2tldCcsXG4gICAgJ2xlYWZsZXQtZGlyZWN0aXZlJ1xuICAgIC8vICd1aS5ib290c3RyYXAnLFxuICAgIC8vICd0ZW1wbGF0ZXMnXG5dKTsiLCJhcHAuY29udHJvbGxlcignTWFpbk1hcEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyR3ZWJzb2NrZXQnLFxuICAgICckZmlsdGVyJyxcbiAgICAnJHRpbWVvdXQnLFxuICAgICckaW50ZXJ2YWwnLFxuICAgICdsZWFmbGV0RGF0YScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkd2Vic29ja2V0LCAkZmlsdGVyLCAkdGltZW91dCwgJGludGVydmFsLCBsZWFmbGV0RGF0YSkge1xuICAgICAgICBhbmd1bGFyLmV4dGVuZCgkc2NvcGUsIHtcbiAgICAgICAgICAgIGNlbnRlcjoge1xuICAgICAgICAgICAgICAgIGxhdDogMzEsXG4gICAgICAgICAgICAgICAgbG5nOiA4NSxcbiAgICAgICAgICAgICAgICB6b29tOiA0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICAgICAgICBsYXQ6IDUxLFxuICAgICAgICAgICAgICAgIGxuZzogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxheWVyczoge1xuICAgICAgICAgICAgICAgIGJhc2VsYXllcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgeHl6OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnQ2xvdWRtYWRlIFRvdXJpc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL3tzfS50aWxlLmNsb3VkbWFkZS5jb20ve2tleX0ve3N0eWxlSWR9LzI1Ni97en0ve3h9L3t5fS5wbmcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICcwMDdiOTQ3MWI0Yzc0ZGE0YTZlYzdmZjQzNTUyYjE2ZicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVJZDogN1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd4eXonXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG92ZXJsYXlzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcnNPdmVybGF5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTWFya2VycycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JvdXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuY29sbGVjdGlvbiA9IFtdO1xuICAgICAgICAkc2NvcGUuc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IDAsXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IDEwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VhcmNoOiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5pc05leHRQYWdlQXZhaWxhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZXR0aW5ncy5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlID49ICRzY29wZS5nZXREYXRhTGVuZ3RoKCkgLyAkc2NvcGUuc2V0dGluZ3MucGFnaW5hdGlvbi5wYWdlU2l6ZSAtIDE7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm51bWJlck9mUGFnZXMgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbCgkc2NvcGUuZ2V0RGF0YUxlbmd0aCgpIC8gJHNjb3BlLnNldHRpbmdzLnBhZ2luYXRpb24ucGFnZVNpemUpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5nZXREYXRhTGVuZ3RoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5jb2xsZWN0aW9uLCB7IG1hYzogJHNjb3BlLnNldHRpbmdzLnNlYXJjaCB9KS5sZW5ndGg7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm1vdmVNYXAgPSBmdW5jdGlvbiAobWFya2VyKSB7XG4gICAgICAgICAgICAkc2NvcGUuY2VudGVyID0ge1xuICAgICAgICAgICAgICAgIGxhdDogbWFya2VyLmxvY2F0aW9uLmxhdCxcbiAgICAgICAgICAgICAgICBsbmc6IG1hcmtlci5sb2NhdGlvbi5sb24sXG4gICAgICAgICAgICAgICAgem9vbTogMTRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGxlYWZsZXRWaWV3ID0gbmV3IFBydW5lQ2x1c3RlckZvckxlYWZsZXQoNjApO1xuICAgICAgICB2YXIgbWFya2VycyA9IHt9O1xuICAgICAgICB2YXIgd3MgPSAkd2Vic29ja2V0KCd3czovL2xvY2FsaG9zdDo4MDkxLycpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldFBvcHVwKG1hcmtlcikge1xuICAgICAgICAgICAgdmFyIHBvcHVwO1xuXG4gICAgICAgICAgICBwb3B1cCA9ICdNQUM6ICcgKyBtYXJrZXIubWFjICsgJzxici8+JyArXG4gICAgICAgICAgICAgICAgJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyArICc8YnIvPicgK1xuICAgICAgICAgICAgICAgICdMQVQ6ICcgKyBtYXJrZXIubG9jYXRpb24ubGF0ICsgJzxici8+JyArXG4gICAgICAgICAgICAgICAgJ0xPTjogJyArIG1hcmtlci5sb2NhdGlvbi5sb24gKyAnPGJyLz4nICtcbiAgICAgICAgICAgICAgICAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nICsgJzxici8+JyArXG4gICAgICAgICAgICAgICAgJ1NUQVRVUzogJyArIChtYXJrZXIuc3RhdHVzICYmIG1hcmtlci5zdGF0dXMuaXNPbmxpbmUgPyAnT05MSU5FJyA6ICdPRkZMSU5FJylcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgcmV0dXJuIHBvcHVwO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcHJlcGFyZU1lc3NhZ2UoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHBhY2thZ2VEYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgIC8vIHZhciBtYXJrZXJzUGFjayA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhY2thZ2VEYXRhLmRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFnID0gcGFja2FnZURhdGEuZGF0YVtpXTtcblxuICAgICAgICAgICAgICAgIGlmIChtYXJrZXJzLmhhc093blByb3BlcnR5KHRhZy5tYWMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhZyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBtYXJrZXJzW3RhZy5tYWNdLCB0YWcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYWNrYWdlRGF0YS5uYW1lID09PSAnbG9jYXRpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWcubWFya2VyLk1vdmUodGFnLmxvY2F0aW9uLmxhdCwgdGFnLmxvY2F0aW9uLmxvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFja2FnZURhdGEubmFtZSA9PT0gJ2xvY2F0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnLm1hcmtlciA9IG5ldyBQcnVuZUNsdXN0ZXIuTWFya2VyKHRhZy5sb2NhdGlvbi5sYXQsIHRhZy5sb2NhdGlvbi5sb24pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXJrZXJzUGFjay5wdXNoKHRhZy5tYXJrZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVhZmxldFZpZXcuUmVnaXN0ZXJNYXJrZXIodGFnLm1hcmtlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0YWcubWFya2VyLmRhdGEuaW5mbyA9IHRhZztcbiAgICAgICAgICAgICAgICBtYXJrZXJzW3RhZy5tYWNdID0gdGFnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiAobWFya2Vyc1BhY2subGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyAgICAgbGVhZmxldFZpZXcuUmVnaXN0ZXJNYXJrZXJzKG1hcmtlcnNQYWNrKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN0YXJ0VHJhY2tpbmcoKXtcbiAgICAgICAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgpLnRoZW4oZnVuY3Rpb24obWFwKSB7XG4gICAgICAgICAgICAgICAgbWFwLmFkZExheWVyKGxlYWZsZXRWaWV3KTtcblxuICAgICAgICAgICAgICAgIGxlYWZsZXRWaWV3LlByZXBhcmVMZWFmbGV0TWFya2VyID0gZnVuY3Rpb24obGVhZmxldE1hcmtlciwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZTtcblxuICAgICAgICAgICAgICAgICAgICBsZWFmbGV0TWFya2VyLm9uKCdwb3B1cG9wZW4nLCBmdW5jdGlvbiAocG9wdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYWZsZXRNYXJrZXIuX3BvcHVwLl9jb250ZW50ID0gZ2V0UG9wdXAoZGF0YS5pbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFmbGV0TWFya2VyLl9wb3B1cC51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGxlYWZsZXRNYXJrZXIub24oJ3BvcHVwY2xvc2UnLCBmdW5jdGlvbiAocG9wdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwocHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghbGVhZmxldE1hcmtlci5nZXRQb3B1cCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWFmbGV0TWFya2VyLmJpbmRQb3B1cChnZXRQb3B1cChkYXRhLmluZm8pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3cy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbmFtZTogJ3N0YXJ0JyB9KSk7XG5cbiAgICAgICAgICAgICAgICB3cy5vbk1lc3NhZ2UoZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChwcmVwYXJlTWVzc2FnZShtZXNzYWdlLmRhdGEpLCAwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVhZmxldFZpZXcuUHJvY2Vzc1ZpZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbGxlY3Rpb24gPSBPYmplY3QudmFsdWVzKG1hcmtlcnMpO1xuICAgICAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzdGFydFRyYWNraW5nKCk7XG4gICAgfVxuXSk7XG5cbmFwcC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpIHtcbiAgICAgICAgc3RhcnQgPSArc3RhcnQ7XG5cbiAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTtcbiAgICB9XG59KTsiXX0=
